<% cases = @handover_cases.upcoming %>

<h2 class="govuk-heading-l">
  Upcoming handovers
</h2>

<p>
  <% if @pom_view %>
    A COM will be allocated in the next 8 weeks. Start getting ready to hand the case over to the community.
  <% else %>
    A COM will be allocated in the next 8 weeks. The POM should start getting ready to hand the case over to the
    community.
  <% end %>
</p>

<%= handover_list_table(table_class: ['upcoming-handovers'],
                        headers: [
                          { type: 'button', body: 'Prisoner details' },
                          @pom_view ? nil : { type: 'button', body: 'POM' },
                          { type: 'button', body: 'COM responsible', sort: 'ascending' },
                          { type: 'button', body: 'Earliest release date' },
                          { type: 'button', body: 'Tier' },
                          { body: 'Handover progress', class: ['handover-progress'] },
                        ].compact) do %>

  <% cases.each do |calc_handover, offender| %>
    <tr class="govuk-table__row allocated-offender">
      <%= render 'handovers/cells/prisoner_details', prison_id: @prison_id, offender: offender %>

      <%= render 'handovers/cells/staff_member', staff_member: offender.staff_member unless @pom_view %>

      <%= render 'handovers/cells/handover_dates', calc_handover: calc_handover %>

      <%= render 'handovers/cells/earliest_release_date', offender: offender %>

      <%= render 'handovers/cells/tier', offender: offender %>

      <%= render 'handovers/cells/handover_progress', prison_id: @prison_id, offender: offender %>
    </tr>
  <% end %>
<% end %>

<% if cases.size == 0 %>
  <p>No upcoming handovers at the moment</p>
<% end %>

<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden"></div>
<div aria-live="polite" role="status" aria-atomic="true" class="govuk-visually-hidden"></div>
